# 業務フロー定義

## 1. 見積書作成フロー

### 1.1 基本フロー
1. 営業担当者が見積書をドラフト作成
2. 顧客情報と商品情報を入力
3. 見積書番号を自動採番（QT-YYYYMM-XXXX）
4. 金額計算を自動実行
5. 承認者に承認依頼を送信（ステータス：承認待ち）
6. 承認者が内容を確認し承認または差戻し
7. 承認後、見積書をPDF生成し顧客に送付（ステータス：発行済み）
8. 顧客からの回答により、ステータスを「受注」または「失注」に更新

### 1.2 ステータス遷移
```
ドラフト → 承認待ち → 承認済み → 発行済み → 受注/失注
```

### 1.3 承認フロー
1. 作成者から承認者への承認依頼
2. 承認者による内容確認
   - 金額の妥当性
   - 商品・サービスの適切性
   - 契約条件の確認
3. 承認または差戻し
4. 承認/差戻し理由の記録

## 2. 発注書受領フロー

### 2.1 基本フロー
1. 顧客から発注書を受領
2. 営業担当者が発注書情報をシステムに登録
3. 発注書番号を手動入力
4. 対応する見積書と紐付け
5. 商品別の契約期間（開始日・終了日）を入力
6. 契約期間に基づき収益計上スケジュールを自動生成
7. 発注書ステータスを「受領済み」に更新
8. 見積ステータスを「受注」に更新
9. 請求書作成プロセスへの移行を通知

### 2.2 ステータス遷移
```
未受領 → 受領済み → 処理中 → 完了
```

### 2.3 収益計上スケジュール生成
1. 契約開始日から終了日までの日数を算出
2. 商品金額を日割り計算
3. 月次で収益計上スケジュールを作成
4. 収益計上予定の確認

## 3. 請求書作成フロー

### 3.1 基本フロー
1. 経理担当者が請求書をドラフト作成
2. 見積書または発注書から請求書を自動生成
3. 発注書の契約期間に基づき請求対象期間を設定
4. 請求書番号を自動採番（INV-YYYYMM-XXXX）
5. 承認者に承認依頼を送信（ステータス：承認待ち）
6. 承認者が内容を確認し承認または差戻し
7. 承認後、請求書をPDF生成し顧客に送付（ステータス：発行済み）
8. 入金確認後、ステータスを「入金済み」に更新

### 3.2 ステータス遷移
```
ドラフト → 承認待ち → 承認済み → 発行済み → 入金済み
```

### 3.3 支払い管理
1. 入金情報の登録
   - 入金日
   - 入金額
   - 入金方法
   - 入金確認者
2. 請求書との紐付け
3. 支払い状況の更新
4. 未払い/延滞の管理

## 4. 収益計上フロー

### 4.1 基本フロー
1. 発注書の商品別契約期間に基づき収益計上スケジュールを自動生成
2. 契約開始日から終了日までの日数を算出
3. 商品金額を日割り計算し月次で収益計上スケジュールを作成
4. 月次で収益計上処理を実行
5. 収益計上データを会計システムに連携
6. 収益計上ステータスを「計上済み」に更新

### 4.2 収益計上方法
1. 一括計上
   - 契約開始時に全額を計上
   - 適用：商品販売など

2. 月次計上
   - 契約期間を月単位で分割して計上
   - 適用：保守サービスなど

3. 日割り計上
   - 契約期間を日単位で分割して計上
   - 適用：リース契約など

### 4.3 収益計上スケジュール管理
1. スケジュールの確認
2. 計上予定日の管理
3. 計上実績の記録
4. 未計上収益の管理

## 5. 月次決算フロー

### 5.1 基本フロー
1. 月次収益計上の実行
2. 未払い請求書の確認
3. 売掛金残高の確認
4. 月次レポートの作成
5. 経営層への報告

### 5.2 月次レポート
1. 売上実績
2. 未収入金状況
3. 収益計上状況
4. 顧客別売上分析
5. 商品別売上分析 